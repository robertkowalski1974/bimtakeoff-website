<!DOCTYPE html>
<html>
<head>
    <title>Clear & Test ROI Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            background: #FF9900;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #e68a00;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>ROI Calculator - Clear & Test</h1>

    <div class="section">
        <h2>Step 1: Clear Everything</h2>
        <p>Clear all localStorage data and caches</p>
        <button onclick="clearAll()">Clear All Data</button>
        <p id="clear-result"></p>
    </div>

    <div class="section">
        <h2>Step 2: Check Current Data</h2>
        <p>View what's currently in localStorage</p>
        <button onclick="checkData()">Check localStorage</button>
        <pre id="data-result">Click button to check data...</pre>
    </div>

    <div class="section">
        <h2>Step 3: Add NEW Format Test Data</h2>
        <p>Add test data in the NEW correct format (projectValue, savings, roi)</p>
        <button onclick="addNewFormatData()">Add NEW Format Data</button>
        <p id="new-result"></p>
    </div>

    <div class="section">
        <h2>Step 4: Go to Thank You Pages</h2>
        <p>Test with the data you just added</p>
        <button onclick="goToThankYouEN()">Test English Thank You Page</button>
        <button onclick="goToThankYouPL()">Test Polish Thank You Page</button>
    </div>

    <div class="section">
        <h2>Step 5: Test Full Flow</h2>
        <p>Go through the complete flow from calculator to thank you page</p>
        <button onclick="goToCalculatorEN()">Go to English Calculator</button>
        <button onclick="goToCalculatorPL()">Go to Polish Calculator</button>
        <p><small>Instructions: Fill in the calculator, submit the form, and check if PDF generates.</small></p>
    </div>

    <script>
        function clearAll() {
            // Clear localStorage
            localStorage.removeItem('bimtakeoff_calculator_data');

            // Clear sessionStorage
            sessionStorage.clear();

            // Report
            document.getElementById('clear-result').innerHTML =
                '<span class="success">‚úÖ All data cleared! (localStorage + sessionStorage)</span>';

            console.log('üßπ Cleared all calculator data');
        }

        function checkData() {
            const data = localStorage.getItem('bimtakeoff_calculator_data');
            const resultEl = document.getElementById('data-result');

            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    resultEl.textContent = JSON.stringify(parsed, null, 2);
                    resultEl.style.color = 'green';

                    // Check format
                    if (parsed.projectValue !== undefined) {
                        resultEl.textContent += '\n\n‚úÖ NEW FORMAT DETECTED (projectValue, savings, roi)';
                    } else if (parsed.project_value !== undefined) {
                        resultEl.textContent += '\n\n‚ö†Ô∏è OLD FORMAT DETECTED (project_value, estimated_savings, roi_percentage)';
                    }
                } catch (e) {
                    resultEl.textContent = 'Error parsing data: ' + e.message;
                    resultEl.style.color = 'red';
                }
            } else {
                resultEl.textContent = '‚ùå No data in localStorage';
                resultEl.style.color = 'red';
            }
        }

        function addNewFormatData() {
            const testData = {
                // NEW FORMAT (correct)
                projectValue: 1000000,
                savings: 150000,
                roi: 15,
                currency: 'EUR',
                project_type: 'commercial',
                timeline: 'standard',
                variance: 10,
                breakdown: {
                    timeSavings: 40000,
                    accuracySavings: 35000,
                    reworkSavings: 40000,
                    changeOrderSavings: 35000,
                    bimCost: 10000
                },
                timestamp: new Date().toISOString(),
                name: 'Test User',
                email: 'test@example.com',
                company: 'Test Company'
            };

            try {
                localStorage.setItem('bimtakeoff_calculator_data', JSON.stringify(testData));
                document.getElementById('new-result').innerHTML =
                    '<span class="success">‚úÖ NEW format data added! Now go to Step 4 to test.</span>';
                console.log('üíæ Saved NEW format test data:', testData);
            } catch (e) {
                document.getElementById('new-result').innerHTML =
                    '<span class="error">‚ùå Error: ' + e.message + '</span>';
            }
        }

        function goToThankYouEN() {
            window.location.href = '/resources/roi-calculator-thank-you.html';
        }

        function goToThankYouPL() {
            window.location.href = '/pl/zasoby/kalkulator-roi-dziekujemy.html';
        }

        function goToCalculatorEN() {
            // Clear first to ensure clean test
            localStorage.removeItem('bimtakeoff_calculator_data');
            window.location.href = '/resources/roi-calculator.html';
        }

        function goToCalculatorPL() {
            // Clear first to ensure clean test
            localStorage.removeItem('bimtakeoff_calculator_data');
            window.location.href = '/pl/zasoby/kalkulator-roi.html';
        }

        // Auto-check data on page load
        window.addEventListener('DOMContentLoaded', function() {
            checkData();
        });
    </script>
</body>
</html>
