<!-- Enhanced Multilingual Navbar and Footer Translation -->
<script>
(function() {
    'use strict';
    
    // Configuration
    const DEBUG = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    
    // Check if we're on a Polish page
    const isPolishPage = () => {
        const path = window.location.pathname;
        return path.includes('/pl/') || 
               path.startsWith('/pl') || 
               path.endsWith('/pl') ||
               (path === '/' && document.documentElement.lang === 'pl');
    };
    
    // Translation dictionary
    const translations = {
        // Main navbar items
        'Home': 'Strona Główna',
        'Services': 'Usługi',
        'Industries': 'Branże',
        'Portfolio': 'Portfolio',
        'Resources': 'Zasoby',
        'About': 'O Nas',
        'Contact': 'Kontakt',
        
        // Services dropdown
        'Cost Estimation & Budget Planning': 'Kosztorysowanie i Planowanie Budżetu',
        'Trade-Specific Specialist Services': 'Specjalistyczne Usługi Branżowe',
        'Automated Quantity Takeoff': 'Zautomatyzowany Przedmiar Ilości',
        'Fast-Track Cost Control': 'Szybka Kontrola Kosztów',
        'BREEAM/ESG Cost Modeling': 'Modelowanie Kosztów BREEAM/ESG',
        'MEP Infrastructure Precision': 'Precyzja Infrastruktury MEP',
        'Multi-Scenario Analysis': 'Analiza Wieloscenariuszowa',
        'Comprehensive Reporting': 'Kompleksowe Raportowanie',
        'Bid Writing & Bid Management': 'Pisanie Ofert i Zarządzanie Przetargami',
        'Traditional Quantity Takeoff': 'Tradycyjny Przedmiar Ilości',
        'Construction Data Management': 'Zarządzanie Danymi Budowlanymi',
        'Construction Logistics': 'Logistyka Budowlana',
        
        // Industries dropdown
        'Warehouses & Logistics': 'Magazyny i Logistyka',
        'Data Centers': 'Centra Danych',
        'Residential Development': 'Deweloperstwo Mieszkaniowe',
        'Remediation': 'Remediacja',
        'Commercial Development': 'Deweloperstwo Komercyjne',
        'Healthcare & Medical Facilities': 'Opieka Zdrowotna i Obiekty Medyczne',
        'Industrial & Manufacturing': 'Przemysł i Produkcja',
        'Infrastructure & Civil Works': 'Infrastruktura i Roboty Inżynieryjne',
        
        // Resources dropdown
        'BIM 2030 Guide': 'Przewodnik BIM 2030',
        'ROI Calculator': 'Kalkulator ROI',
        'Case Studies': 'Studia Przypadków',
        
        // Footer text
        'All rights reserved': 'Wszelkie prawa zastrzeżone',
        'Professional BIM 5D Cost Estimation Services': 'Profesjonalne Usługi Kosztorysowania BIM 5D',
        'Quick Links': 'Szybkie Linki',
        'Privacy Policy': 'Polityka Prywatności',
        'Terms of Service': 'Warunki Usługi',
        'Contact': 'Kontakt',
        
        // Phone numbers
        '+44 (0) 20 3239 9967': '+48 508 209 313'
    };
    
    // Logging function
    const log = (message, ...args) => {
        if (DEBUG) {
            console.log('[BilingualNav]', message, ...args);
        }
    };
    
    // Main translation function
    function translatePage() {
        if (!isPolishPage()) {
            log('Not on Polish page, skipping translation');
            return;
        }
        
        log('Translating page to Polish...');
        let translationCount = 0;
        
        // Set HTML lang attribute
        document.documentElement.lang = 'pl';
        log('Set document language to Polish');
        
        // Translate navbar menu items
        document.querySelectorAll('.navbar .menu-text').forEach(element => {
            const text = element.textContent.trim();
            if (translations[text]) {
                element.textContent = translations[text];
                translationCount++;
                log(`Translated navbar item: "${text}" -> "${translations[text]}"`);
            }
        });
        
        // Translate dropdown items
        document.querySelectorAll('.navbar .dropdown-text').forEach(element => {
            const text = element.textContent.trim();
            if (translations[text]) {
                element.textContent = translations[text];
                translationCount++;
                log(`Translated dropdown item: "${text}" -> "${translations[text]}"`);
            }
        });
        
        // Translate footer
        const footer = document.querySelector('.nav-footer, footer');
        if (footer) {
            log('Translating footer...');
            translateFooter(footer);
        }
        
        log(`Translation complete. ${translationCount} items translated.`);
    }
    
    // Footer translation with text node walking
    function translateFooter(footer) {
        // First, handle phone links specifically
        const phoneLinks = footer.querySelectorAll('a[href^="tel:"]');
        phoneLinks.forEach(link => {
            const text = link.textContent.trim();
            if (translations[text]) {
                link.textContent = translations[text];
                // Also update the href attribute
                const newHref = 'tel:' + translations[text].replace(/\s/g, '');
                link.setAttribute('href', newHref);
                log(`Translated phone link: "${text}" -> "${translations[text]}"`);
            }
        });
        
        // Then handle all other text nodes
        const walker = document.createTreeWalker(
            footer,
            NodeFilter.SHOW_TEXT,
            {
                acceptNode: (node) => {
                    // Skip empty text nodes and script/style elements
                    if (!node.nodeValue || !node.nodeValue.trim()) {
                        return NodeFilter.FILTER_REJECT;
                    }
                    if (node.parentElement && 
                        (node.parentElement.tagName === 'SCRIPT' || 
                         node.parentElement.tagName === 'STYLE')) {
                        return NodeFilter.FILTER_REJECT;
                    }
                    return NodeFilter.FILTER_ACCEPT;
                }
            }
        );
        
        const nodesToUpdate = [];
        let node;
        while (node = walker.nextNode()) {
            nodesToUpdate.push(node);
        }
        
        // Update all collected nodes
        nodesToUpdate.forEach(node => {
            let text = node.nodeValue;
            let updated = false;
            
            Object.keys(translations).forEach(eng => {
                if (text.includes(eng)) {
                    text = text.replace(new RegExp(eng, 'g'), translations[eng]);
                    updated = true;
                }
            });
            
            if (updated) {
                node.nodeValue = text;
                log(`Translated footer text: "${node.nodeValue}"`);
            }
        });
    }
    
    // Initialize translation
    function init() {
        log('Bilingual translation script initialized');
        log('Current URL:', window.location.href);
        log('Is Polish page:', isPolishPage());
        
        // Run translation immediately
        translatePage();
        
        // Run after DOM content loaded (if not already loaded)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                log('DOM Content Loaded - running translation');
                translatePage();
            });
        }
        
        // Run after a short delay to catch any dynamically loaded content
        setTimeout(() => {
            log('Delayed translation check');
            translatePage();
        }, 200);
        
        // For Quarto preview - observe DOM changes
        if (DEBUG) {
            const observer = new MutationObserver((mutations) => {
                const shouldRetranslate = mutations.some(mutation => {
                    return mutation.target.classList && 
                           (mutation.target.classList.contains('navbar') || 
                            mutation.target.classList.contains('nav-footer') ||
                            mutation.target.classList.contains('dropdown-menu'));
                });
                
                if (shouldRetranslate) {
                    log('Navbar/footer mutation detected, re-translating');
                    translatePage();
                }
            });
            
            observer.observe(document.body, { 
                childList: true, 
                subtree: true,
                attributes: true,
                attributeFilter: ['class']
            });
            
            log('Mutation observer active');
        }
    }
    
    // Start the script
    init();
})();
</script>
